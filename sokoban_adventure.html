<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¥ç§˜ä»“åº“çš„å†’é™© - æ¨ç®±å­</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .game-container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        
        .story-panel {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #ffd700;
        }
        
        .character {
            font-weight: bold;
            color: #ffd700;
        }
        
        .dialogue {
            margin: 10px 0;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 5px;
            font-style: italic;
        }
        
        .game-board {
            display: grid;
            gap: 2px;
            background: #333;
            padding: 10px;
            border-radius: 10px;
            margin: 20px 0;
            justify-content: center;
        }
        
        .cell {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            background: #f0f0f0;
            border-radius: 3px;
        }
        
        .wall { background: #8B4513; }
        .floor { background: #F5DEB3; }
        .target { background: #FFD700; }
        .box { background: #8B4513; color: white; }
        .box-on-target { background: #32CD32; color: white; }
        .player { background: #FF6B6B; color: white; }
        
        .controls {
            text-align: center;
            margin: 20px 0;
        }
        
        .controls button {
            background: #ffd700;
            color: #333;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .controls button:hover {
            background: #ffed4e;
            transform: translateY(-2px);
        }
        
        .info-panel {
            display: flex;
            justify-content: space-between;
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .level-info {
            font-weight: bold;
            color: #ffd700;
        }
        
        .instructions {
            text-align: center;
            margin: 15px 0;
            color: #ccc;
        }
        
        .victory-message {
            background: rgba(50, 205, 50, 0.3);
            border: 2px solid #32CD32;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin: 20px 0;
            display: none;
        }
        
        .story-dialogue {
            display: none;
            background: rgba(0, 0, 0, 0.9);
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .dialogue-box {
            background: rgba(255, 255, 255, 0.95);
            color: #333;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
        }
        
        .dialogue-box button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 15px;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1 style="text-align: center; color: #ffd700; text-shadow: 2px 2px 4px rgba(0,0,0,0.5);">
            ğŸ° ç¥ç§˜ä»“åº“çš„å†’é™© ğŸ“¦
        </h1>
        
        <div class="story-panel">
            <div class="character">ğŸ“œ èƒŒæ™¯æ•…äº‹:</div>
            <div class="dialogue">
                ä½ æ˜¯ä¸€åå¹´è½»çš„è€ƒå¤å­¦å®¶è‰¾è‰å…‹æ–¯ï¼Œåœ¨æ¢ç´¢ä¸€åº§å¤è€åŸå ¡æ—¶å‘ç°äº†ä¸€ä¸ªç¥ç§˜çš„ä»“åº“ã€‚
                ä¼ è¯´è¿™é‡Œéšè—ç€å¤ä»£æ™ºè€…ç•™ä¸‹çš„å®è—ï¼Œä½†åªæœ‰é€šè¿‡å·§å¦™åœ°ç§»åŠ¨å¤è€çš„çŸ³ç®±ï¼Œ
                æ‰èƒ½è§£å¼€è°œé¢˜ï¼Œè·å¾—å®è—çš„çº¿ç´¢...
            </div>
        </div>
        
        <div class="info-panel">
            <div class="level-info">å…³å¡: <span id="currentLevel">1</span> / <span id="totalLevels">5</span></div>
            <div>æ­¥æ•°: <span id="moveCount">0</span></div>
            <div>æ¨ç®±æ¬¡æ•°: <span id="pushCount">0</span></div>
        </div>
        
        <div id="gameBoard" class="game-board"></div>
        
        <div class="instructions">
            ä½¿ç”¨ â†‘â†“â†â†’ æ–¹å‘é”®æˆ– WASD é”®ç§»åŠ¨ | ğŸ¯ å°†æ‰€æœ‰ç®±å­æ¨åˆ°ç›®æ ‡ä½ç½®
        </div>
        
        <div class="controls">
            <button onclick="resetLevel()">ğŸ”„ é‡ç½®å…³å¡</button>
            <button onclick="showStory()">ğŸ“– æŸ¥çœ‹å‰§æƒ…</button>
            <button onclick="showControls()">â“ å¸®åŠ©</button>
        </div>
        
        <div id="victoryMessage" class="victory-message">
            <h3>ğŸ‰ æ­å–œè¿‡å…³ï¼</h3>
            <p id="victoryText"></p>
            <button onclick="nextLevel()">ç»§ç»­å†’é™© â¡ï¸</button>
        </div>
        
        <div id="storyDialogue" class="story-dialogue">
            <div class="dialogue-box">
                <div id="storyContent"></div>
                <button onclick="closeStory()">ç»§ç»­æ¸¸æˆ</button>
            </div>
        </div>
    </div>

    <script>
        // æ¸¸æˆçŠ¶æ€
        let currentLevel = 1;
        let playerPos = { x: 0, y: 0 };
        let boxes = [];
        let targets = [];
        let walls = [];
        let moveCount = 0;
        let pushCount = 0;
        
        // å…³å¡æ•°æ®å’Œå‰§æƒ…
        const levels = [
            {
                name: "åˆå…¥ä»“åº“",
                story: "ğŸšª è‰¾è‰å…‹æ–¯æ¨å¼€åšé‡çš„æœ¨é—¨ï¼Œè¸å…¥äº†ç¥ç§˜çš„ä»“åº“ã€‚æ˜æš—çš„å…‰çº¿ä¸­ï¼Œä½ çœ‹åˆ°äº†ç¬¬ä¸€ä¸ªè°œé¢˜...",
                map: [
                    "######",
                    "#    #",
                    "#  $ #",
                    "#  . #",
                    "#  @ #",
                    "######"
                ],
                hint: "è¿™é‡Œåªæœ‰ä¸€ä¸ªç®±å­å’Œä¸€ä¸ªç›®æ ‡ä½ç½®ï¼Œè¯•ç€æ¨åŠ¨ç®±å­åˆ°é‡‘è‰²çš„ç›®æ ‡ç‚¹ä¸Šï¼"
            },
            {
                name: "å¤è€çš„æœºå…³",
                story: "ğŸ”§ å½“ç¬¬ä¸€ä¸ªç®±å­åˆ°ä½æ—¶ï¼Œåœ°é¢å¾®å¾®éœ‡åŠ¨ã€‚è‰¾è‰å…‹æ–¯æ„è¯†åˆ°è¿™äº›ä¸æ˜¯æ™®é€šçš„ç®±å­ï¼Œè€Œæ˜¯å¤è€çš„æœºå…³è£…ç½®ï¼",
                map: [
                    "#######",
                    "#     #",
                    "# $   #",
                    "# . . #",
                    "#   $ #",
                    "#  @  #",
                    "#######"
                ],
                hint: "ä¸¤ä¸ªç®±å­ï¼Œä¸¤ä¸ªç›®æ ‡ã€‚å°å¿ƒè§„åˆ’è·¯çº¿ï¼Œä¸è¦æŠŠç®±å­æ¨åˆ°è§’è½é‡Œï¼"
            },
            {
                name: "æ™ºè€…çš„è€ƒéªŒ",
                story: "ğŸ“š å¢™ä¸Šæµ®ç°å‡ºå¤è€çš„æ–‡å­—ï¼š'æ™ºæ…§ä¸åœ¨äºåŠ›é‡ï¼Œè€Œåœ¨äºå·§æ€ã€‚åªæœ‰æ‡‚å¾—è¿‚å›çš„äººï¼Œæ‰èƒ½åˆ°è¾¾ç›®æ ‡ã€‚'",
                map: [
                    "########",
                    "#   .  #",
                    "#   $  #",
                    "## ### #",
                    "#  $   #",
                    "#  . @ #",
                    "########"
                ],
                hint: "è¿™ä¸ªå…³å¡éœ€è¦ä½ ç»•è·¯ã€‚è®°ä½ï¼Œæœ‰æ—¶å€™åé€€ä¸€æ­¥æ˜¯ä¸ºäº†æ›´å¥½åœ°å‰è¿›ï¼"
            },
            {
                name: "è¿·å®«ä¹‹å¿ƒ",
                story: "ğŸŒŸ ä»“åº“çš„ä¸­å¤®å‡ºç°äº†ä¸€ä¸ªå¤æ‚çš„è¿·å®«ã€‚è‰¾è‰å…‹æ–¯æ„Ÿè§‰åˆ°å®è—å°±åœ¨é™„è¿‘ï¼Œä½†è¿™ä¸ªè°œé¢˜æ¯”ä¹‹å‰çš„éƒ½è¦å›°éš¾...",
                map: [
                    "##########",
                    "#        #",
                    "# $$ ##  #",
                    "# $  ##  #",
                    "##       #",
                    "# .. .. ##",
                    "#    @   #",
                    "##########"
                ],
                hint: "å››ä¸ªç®±å­çš„æŒ‘æˆ˜ï¼ä»”ç»†è§‚å¯Ÿï¼Œæ‰¾å‡ºæ­£ç¡®çš„æ¨åŠ¨é¡ºåºã€‚"
            },
            {
                name: "å®è—å¯†å®¤",
                story: "ğŸ’ æœ€åçš„è€ƒéªŒï¼ä»“åº“æ·±å¤„çš„å¯†å®¤é—¨ç¼“ç¼“æ‰“å¼€ï¼Œé‡Œé¢é‡‘å…‰é—ªé—ªã€‚ä½†è¦è·å¾—å®è—ï¼Œä½ å¿…é¡»è§£å¼€è¿™æœ€åçš„è°œé¢˜...",
                map: [
                    "###########",
                    "#         #",
                    "# $$   $$ #",
                    "#  .   .  #",
                    "#    $    #",
                    "#  .   .  #",
                    "# $$   $$ #",
                    "#    @    #",
                    "###########"
                ],
                hint: "ç»ˆææŒ‘æˆ˜ï¼ä¸ƒä¸ªç®±å­éœ€è¦ç²¾ç¡®çš„å¸ƒå±€ã€‚è¿™æ˜¯å¯¹ä½ æ‰€æœ‰æŠ€å·§çš„ç»ˆæè€ƒéªŒï¼"
            }
        ];
        
        // èƒœåˆ©ä¿¡æ¯
        const victoryMessages = [
            "ğŸŠ å¤ªæ£’äº†ï¼ä½ å­¦ä¼šäº†åŸºæœ¬çš„æ¨ç®±æŠ€å·§ã€‚å¤è€çš„æœºå…³å‘å‡ºäº†æ»¡æ„çš„å£°éŸ³...",
            "âš¡ æœºå…³æ¿€æ´»äº†ï¼ä»“åº“çš„æŸå¤„ä¼ æ¥äº†ç¥ç§˜çš„å“å£°ã€‚ä½ æ„Ÿè§‰ç¦»çœŸç›¸æ›´è¿‘äº†ä¸€æ­¥ã€‚",
            "ğŸ”® æ™ºè€…çš„è€ƒéªŒé€šè¿‡äº†ï¼å¢™ä¸Šçš„æ–‡å­—å¼€å§‹å‘å…‰ï¼ŒæŒ‡å‘ä»“åº“çš„æ›´æ·±å¤„...",
            "ğŸŒŸ è¿·å®«çš„åŠ›é‡è§‰é†’äº†ï¼æ•´ä¸ªä»“åº“éƒ½åœ¨è½»å¾®åœ°éœ‡åŠ¨ï¼Œä½ æ„Ÿå—åˆ°äº†å¤è€é­”æ³•çš„æ³¢åŠ¨ã€‚",
            "ğŸ† æ­å–œï¼ä½ æˆåŠŸè§£å¼€äº†æ‰€æœ‰è°œé¢˜ï¼è‰¾è‰å…‹æ–¯åœ¨å®è—ç®±ä¸­å‘ç°äº†ä¸€å¼ å¤è€çš„åœ°å›¾ï¼Œè¿™åªæ˜¯æ›´å¤§å†’é™©çš„å¼€å§‹..."
        ];
        
        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            loadLevel(currentLevel);
            updateDisplay();
        }
        
        // åŠ è½½å…³å¡
        function loadLevel(level) {
            const levelData = levels[level - 1];
            const map = levelData.map;
            
            // é‡ç½®æ¸¸æˆçŠ¶æ€
            boxes = [];
            targets = [];
            walls = [];
            moveCount = 0;
            pushCount = 0;
            
            // è§£æåœ°å›¾
            for (let y = 0; y < map.length; y++) {
                for (let x = 0; x < map[y].length; x++) {
                    const char = map[y][x];
                    switch (char) {
                        case '@':
                            playerPos = { x, y };
                            break;
                        case '$':
                            boxes.push({ x, y });
                            break;
                        case '.':
                            targets.push({ x, y });
                            break;
                        case '#':
                            walls.push({ x, y });
                            break;
                    }
                }
            }
            
            // è®¾ç½®æ¸¸æˆæ¿å¤§å°
            const gameBoard = document.getElementById('gameBoard');
            gameBoard.style.gridTemplateColumns = `repeat(${map[0].length}, 40px)`;
            
            renderGame();
            updateDisplay();
        }
        
        // æ¸²æŸ“æ¸¸æˆ
        function renderGame() {
            const gameBoard = document.getElementById('gameBoard');
            const levelData = levels[currentLevel - 1];
            const map = levelData.map;
            
            gameBoard.innerHTML = '';
            
            for (let y = 0; y < map.length; y++) {
                for (let x = 0; x < map[y].length; x++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    
                    // æ£€æŸ¥æ˜¯å¦æ˜¯å¢™
                    if (walls.some(w => w.x === x && w.y === y)) {
                        cell.className += ' wall';
                        cell.textContent = 'ğŸ§±';
                    }
                    // æ£€æŸ¥æ˜¯å¦æ˜¯ç›®æ ‡ä½ç½®
                    else if (targets.some(t => t.x === x && t.y === y)) {
                        cell.className += ' target';
                        cell.textContent = 'ğŸ¯';
                    }
                    // æ™®é€šåœ°é¢
                    else {
                        cell.className += ' floor';
                    }
                    
                    // æ£€æŸ¥æ˜¯å¦æœ‰ç®±å­
                    const box = boxes.find(b => b.x === x && b.y === y);
                    if (box) {
                        const isOnTarget = targets.some(t => t.x === x && t.y === y);
                        cell.className = 'cell ' + (isOnTarget ? 'box-on-target' : 'box');
                        cell.textContent = 'ğŸ“¦';
                    }
                    
                    // æ£€æŸ¥æ˜¯å¦æ˜¯ç©å®¶ä½ç½®
                    if (playerPos.x === x && playerPos.y === y) {
                        cell.className = 'cell player';
                        cell.textContent = 'ğŸ§‘â€ğŸ’¼';
                    }
                    
                    gameBoard.appendChild(cell);
                }
            }
        }
        
        // ç§»åŠ¨ç©å®¶
        function movePlayer(dx, dy) {
            const newX = playerPos.x + dx;
            const newY = playerPos.y + dy;
            
            // æ£€æŸ¥æ˜¯å¦æ’å¢™
            if (walls.some(w => w.x === newX && w.y === newY)) {
                return;
            }
            
            // æ£€æŸ¥æ˜¯å¦æœ‰ç®±å­
            const boxIndex = boxes.findIndex(b => b.x === newX && b.y === newY);
            if (boxIndex !== -1) {
                // è®¡ç®—ç®±å­çš„æ–°ä½ç½®
                const boxNewX = newX + dx;
                const boxNewY = newY + dy;
                
                // æ£€æŸ¥ç®±å­æ–°ä½ç½®æ˜¯å¦æœ‰æ•ˆ
                if (walls.some(w => w.x === boxNewX && w.y === boxNewY) ||
                    boxes.some(b => b.x === boxNewX && b.y === boxNewY)) {
                    return; // ç®±å­æ— æ³•ç§»åŠ¨
                }
                
                // ç§»åŠ¨ç®±å­
                boxes[boxIndex].x = boxNewX;
                boxes[boxIndex].y = boxNewY;
                pushCount++;
            }
            
            // ç§»åŠ¨ç©å®¶
            playerPos.x = newX;
            playerPos.y = newY;
            moveCount++;
            
            renderGame();
            updateDisplay();
            checkVictory();
        }
        
        // æ£€æŸ¥èƒœåˆ©æ¡ä»¶
        function checkVictory() {
            const allBoxesOnTargets = targets.every(target =>
                boxes.some(box => box.x === target.x && box.y === target.y)
            );
            
            if (allBoxesOnTargets) {
                setTimeout(() => {
                    const victoryMsg = document.getElementById('victoryMessage');
                    const victoryText = document.getElementById('victoryText');
                    victoryText.textContent = victoryMessages[currentLevel - 1];
                    victoryMsg.style.display = 'block';
                }, 500);
            }
        }
        
        // ä¸‹ä¸€å…³
        function nextLevel() {
            document.getElementById('victoryMessage').style.display = 'none';
            
            if (currentLevel < levels.length) {
                currentLevel++;
                loadLevel(currentLevel);
                
                // æ˜¾ç¤ºæ–°å…³å¡å‰§æƒ…
                setTimeout(() => {
                    showLevelStory();
                }, 500);
            } else {
                alert('ğŸ‰ æ­å–œï¼ä½ å·²ç»å®Œæˆäº†æ‰€æœ‰å…³å¡ï¼è‰¾è‰å…‹æ–¯çš„å†’é™©è¿˜å°†ç»§ç»­...');
            }
        }
        
        // é‡ç½®å…³å¡
        function resetLevel() {
            loadLevel(currentLevel);
        }
        
        // æ˜¾ç¤ºå‰§æƒ…
        function showStory() {
            showLevelStory();
        }
        
        function showLevelStory() {
            const levelData = levels[currentLevel - 1];
            const storyContent = document.getElementById('storyContent');
            storyContent.innerHTML = `
                <h3>${levelData.name}</h3>
                <p style="margin: 15px 0;">${levelData.story}</p>
                <p style="color: #666; font-style: italic;">ğŸ’¡ æç¤º: ${levelData.hint}</p>
            `;
            document.getElementById('storyDialogue').style.display = 'flex';
        }
        
        // å…³é—­å‰§æƒ…å¯¹è¯
        function closeStory() {
            document.getElementById('storyDialogue').style.display = 'none';
        }
        
        // æ˜¾ç¤ºæ§åˆ¶è¯´æ˜
        function showControls() {
            alert(`ğŸ® æ¸¸æˆæ§åˆ¶ï¼š
            
ğŸ“± ç§»åŠ¨ï¼š
â€¢ æ–¹å‘é”® â†‘â†“â†â†’
â€¢ WASD é”®
â€¢ ç‚¹å‡»æŒ‰é’®

ğŸ¯ ç›®æ ‡ï¼š
â€¢ å°†æ‰€æœ‰ ğŸ“¦ ç®±å­æ¨åˆ° ğŸ¯ ç›®æ ‡ä½ç½®ä¸Š
â€¢ ç®±å­åœ¨ç›®æ ‡ä½ç½®ä¸Šä¼šå˜æˆç»¿è‰²

âš ï¸ æ³¨æ„ï¼š
â€¢ ä¸èƒ½æ‹‰ç®±å­ï¼Œåªèƒ½æ¨
â€¢ ä¸è¦æŠŠç®±å­æ¨åˆ°è§’è½
â€¢ åˆç†è§„åˆ’ç§»åŠ¨è·¯çº¿

ğŸ† æŒ‘æˆ˜è‡ªå·±ï¼š
â€¢ ç”¨æœ€å°‘çš„æ­¥æ•°å®Œæˆå…³å¡
â€¢ ç”¨æœ€å°‘çš„æ¨ç®±æ¬¡æ•°è¿‡å…³`);
        }
        
        // æ›´æ–°æ˜¾ç¤ºä¿¡æ¯
        function updateDisplay() {
            document.getElementById('currentLevel').textContent = currentLevel;
            document.getElementById('totalLevels').textContent = levels.length;
            document.getElementById('moveCount').textContent = moveCount;
            document.getElementById('pushCount').textContent = pushCount;
        }
        
        // é”®ç›˜äº‹ä»¶ç›‘å¬
        document.addEventListener('keydown', (e) => {
            switch (e.key) {
                case 'ArrowUp':
                case 'w':
                case 'W':
                    e.preventDefault();
                    movePlayer(0, -1);
                    break;
                case 'ArrowDown':
                case 's':
                case 'S':
                    e.preventDefault();
                    movePlayer(0, 1);
                    break;
                case 'ArrowLeft':
                case 'a':
                case 'A':
                    e.preventDefault();
                    movePlayer(-1, 0);
                    break;
                case 'ArrowRight':
                case 'd':
                case 'D':
                    e.preventDefault();
                    movePlayer(1, 0);
                    break;
                case 'r':
                case 'R':
                    resetLevel();
                    break;
            }
        });
        
        // åˆå§‹åŒ–æ¸¸æˆ
        initGame();
        
        // æ˜¾ç¤ºå¼€åœºå‰§æƒ…
        setTimeout(() => {
            showLevelStory();
        }, 1000);
    </script>
</body>
</html>